input {
  dead_letter_queue {
    path => "/usr/share/logstash/data/dead_letter_queue"
    commit_offsets => true
    clean_consumed => true
    pipeline_id => "redis"
  }
}

output {
  stdout {
    codec => rubydebug { metadata => true }
  }
  elasticsearch {
        hosts => ["https://${ELASTICSEARCH_HOST}:9200"]
        user => "${LOGSTASH_USER}"
        password => "${LOGSTASH_PASSWORD}"
        index => "dlq_errors"
        retry_on_conflict => 3
        timeout => 60
        action => "index"
        manage_template => true
        template_name => "logstash_dynamic_template"
        template_overwrite => true
        template => "/usr/share/logstash/config/elasticsearch-template.json"
        ssl_verification_mode => "full"
        ssl_certificate_authorities => "${LOGSTASH_CACERT}"
        ssl_keystore_path => "${LOGSTASH_P12}"
        ssl_keystore_password => "${LOGSTASH_KEYSTORE_PASS}"
    }
}
